<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="Bbs">

<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // admin.do, qna.do -->

    
    
    
<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // detail.do -->

    
    
    
<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // login.do, signup.do -->

    
    
    
<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // main.do -->
    <select id="mainbbslist" parameterType="mul.cam.a.dto.BbsDto" resultType="mul.cam.a.dto.BbsDto">
        select * 
        from bbs 
        where 1=1
    </select>
    
    <select id="mainbbslist2" parameterType="mul.cam.a.dto.BbsDto" resultType="mul.cam.a.dto.BbsDto">
        select * 
        from bbs 
        where id=#{id}
    </select>
    
    <select id="bbslist" parameterType="mul.cam.a.dto.BbsParam"
	resultType="mul.cam.a.dto.BbsDto">
	
		select seq, id, ref, step, depth, title, content, wdate, del, readcount
		from
			(select row_number()over(order by ref desc, step asc) as rnum,
				seq, id, ref, step, depth, title, content, wdate, del, readcount
			 from bbs
			 where 1=1 
			 <if test="choice != null and choice != '' and search != null and search != '' ">
			 	<if test="choice == 'title'">
			 		and title like concat('%', #{search}, '%') and del=0
			 	</if>
			 	<if test="choice == 'content'">
			 		and content like concat('%', #{search}, '%') and del=0
			 	</if>
			 	<if test="choice == 'writer'">
			 		and id=#{search} and del=0
			 	</if>
			 </if>		 
			 order by ref desc, step asc) a
		where rnum between ${start} and ${end}
	</select>
    
    <select id="getBbsTest" parameterType="Integer" resultType="mul.cam.a.dto.BbsDto">
        select seq, id, ref, step, depth, title, content, wdate, del, readcount
        from bbs
        where seq=#{seq}
    </select>
    
    <update id="updateBbs" parameterType="mul.cam.a.dto.BbsDto">
        update bbs
        set title=#{title}, content=#{content}, wdate=now()
        where seq=#{seq}
    </update>
    
	
	
	<insert id="bbsTempwriteAf"  parameterType="mul.cam.a.dto.BbsDto">
	insert into tempbbs(id,nickname,title,content,
	hashtags,wdate,date,del,readcount,likecount,filename, newfilename)
	values(#{id},#{nickname},#{title},#{content},#{hashtags},now(),#{date},0,0,0
	#{filename},#{newfilename})	
	</insert>
	
	<update id="bbsTempupdateAf"  parameterType="mul.cam.a.dto.BbsDto">
	update tempbbs
	set title=#{title}, hashtags=#{hashtags}, content=#{content},wdate=now()
	,date=#{date},filename=#{filename},newfilename=#{newfilename}
	
	where seq=#{seq}
		
	</update>
	
	<select id="bbstTempList" resultType="mul.cam.a.dto.BbsDto">
	select * from tempbbs;
	
	</select>
	
	<select id="bbstTempDto" parameterType="String" resultType="mul.cam.a.dto.BbsDto">
	select * from tempbbs where date=#{date};

	</select>
	
	<delete id="bbsTempdelete" parameterType="String">
	delete from tempbbs where date=#{date}
	</delete>



    
</mapper>