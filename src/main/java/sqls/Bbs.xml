<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="Bbs">

<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // admin.do, qna.do -->

    
    
    
<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // detail.do -->

    
    
    
<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // login.do, signup.do -->

    
    
    
<!--     // ========== ========== ========== ========== ========== ========== ========== 
    // main.do -->
    <select id="mainbbslist" parameterType="mul.cam.a.dto.BbsDto" resultType="mul.cam.a.dto.BbsDto">
        select * 
        from bbs 
        where 1=1 order by likecount desc
    </select>
    
    <select id="mainbbslist2" parameterType="mul.cam.a.dto.BbsDto" resultType="mul.cam.a.dto.BbsDto">
        select * 
        from bbs 
        where id=#{id}
    </select>
    
    <select id="bbslist" parameterType="mul.cam.a.dto.BbsParam"
	resultType="mul.cam.a.dto.BbsDto">
	
		select seq, id, title, nickname, content, wdate, del, readcount, likecount
		from
			(select row_number()over(order by likecount desc) as rnum,
				seq, id, title, nickname, content, wdate, del, readcount, likecount
			 from bbs
			 where 1=1 
			 <if test="choice != null and choice != '' and search != null and search != '' ">
			 	<if test="choice == 'title'">
			 		and title like concat('%', #{search}, '%') and del=0
			 	</if>
			 	<if test="choice == 'content'">
			 		and content like concat('%', #{search}, '%') and del=0
			 	</if>
			 	<if test="choice == 'writer'">
			 		and id=#{search} and del=0
			 	</if>
			 </if>		 
			 order by likecount desc) a
		where rnum between ${start} and ${end}
	</select>
	
	    <!-- 글의 총수 -->
	<select id="getAllBbs" parameterType="mul.cam.a.dto.BbsParam" resultType="java.lang.Integer">
	    
	    select ifnull(count(*), 0)
	    from bbs
	    <if test="choice != null and choice != '' and search != null and search != '' ">
	        <if test="choice == 'title'">
	            where title like concat('%', #{search}, '%') and del=0
	        </if>
	        <if test="choice == 'content'">
	            where content like concat('%', #{search}, '%') and del=0
	        </if>
	        <if test="choice == 'writer'">
	            where id=#{search} and del=0
	        </if>
	     </if>
	</select>
    
    <select id="getBbsTest" parameterType="Integer" resultType="mul.cam.a.dto.BbsDto">
        select seq, id, title, nickname, content, wdate, del, readcount, likecount
        from bbs
        where seq=#{seq}
    </select>
    
    <update id="updateBbs" parameterType="mul.cam.a.dto.BbsDto">
        update bbs
        set title=#{title}, content=#{content}, wdate=now()
        where seq=#{seq}
    </update>

    
</mapper>